<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#667eea">
  <meta name="description" content="ÈÖç‰ø°ËÄÖÂ∞ÇÁî®„Ç´„Éº„Éâ„Éë„ÉÉ„ÇØË≤©Â£≤„Éó„É©„ÉÉ„Éà„Éï„Ç©„Éº„É†">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Pack&Play">
  <title>OBS Overlay - Pack&Play</title>
  <link rel="manifest" href="../manifest.json">
  <link rel="icon" type="image/png" sizes="192x192" href="../assets/images/icon-192.png">
  <link rel="apple-touch-icon" href="../assets/images/icon-192.png">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      width: 1920px;
      height: 1080px;
      background: transparent;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans JP', sans-serif;
      overflow: hidden;
      position: relative;
    }

    .card-effect {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(255, 255, 255, 0.95);
      border-radius: 2rem;
      padding: 3rem;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
      text-align: center;
      min-width: 400px;
      animation: cardAppear 0.5s ease-out;
      z-index: 100;
    }

    @keyframes cardAppear {
      from {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.5) rotate(-10deg);
      }
      to {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1) rotate(0deg);
      }
    }

    .card-effect.fadeOut {
      animation: cardDisappear 0.5s ease-out forwards;
    }

    @keyframes cardDisappear {
      from {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
      }
      to {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.8);
      }
    }

    .card-icon {
      font-size: 6rem;
      margin-bottom: 1rem;
      animation: bounce 1s infinite;
    }

    @keyframes bounce {
      0%, 100% {
        transform: translateY(0);
      }
      50% {
        transform: translateY(-20px);
      }
    }

    .card-name {
      font-size: 3rem;
      font-weight: 800;
      margin-bottom: 0.5rem;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .card-rarity {
      display: inline-block;
      padding: 0.5rem 1.5rem;
      border-radius: 9999px;
      font-size: 1.5rem;
      font-weight: 700;
      color: white;
      margin-bottom: 1rem;
    }

    .card-rarity.n {
      background: #9ca3af;
    }

    .card-rarity.r {
      background: #3b82f6;
    }

    .card-rarity.sr {
      background: #8b5cf6;
    }

    .card-rarity.ur {
      background: linear-gradient(135deg, #f59e0b 0%, #ef4444 100%);
      animation: rainbowPulse 2s infinite;
    }

    @keyframes rainbowPulse {
      0%, 100% {
        transform: scale(1);
        filter: brightness(1);
      }
      50% {
        transform: scale(1.1);
        filter: brightness(1.2);
      }
    }

    .viewer-message {
      font-size: 1.5rem;
      color: #1f2937;
      margin-top: 1rem;
      padding: 1.5rem;
      background: #f3f4f6;
      border-radius: 1rem;
      border-left: 4px solid #d946a6;
    }

    .viewer-name {
      font-size: 1.25rem;
      color: #6b7280;
      margin-top: 0.5rem;
    }

    /* „Éë„Éº„ÉÜ„Ç£„ÇØ„É´„Ç®„Éï„Çß„ÇØ„Éà */
    .particle {
      position: absolute;
      width: 20px;
      height: 20px;
      background: white;
      border-radius: 50%;
      pointer-events: none;
      animation: particleFloat 3s ease-out forwards;
    }

    @keyframes particleFloat {
      from {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
      to {
        opacity: 0;
        transform: translateY(-200px) scale(0);
      }
    }

    /* „Åç„Çâ„Åç„Çâ„Ç®„Éï„Çß„ÇØ„Éà */
    .sparkle {
      position: absolute;
      width: 0;
      height: 0;
      background: transparent;
    }

    .sparkle::before,
    .sparkle::after {
      content: '';
      position: absolute;
      width: 30px;
      height: 4px;
      background: white;
      top: 0;
      left: -15px;
    }

    .sparkle::after {
      transform: rotate(90deg);
    }

    .sparkle {
      animation: sparkleRotate 1s linear infinite, sparkleFade 2s ease-out forwards;
    }

    @keyframes sparkleRotate {
      from {
        transform: rotate(0deg);
      }
      to {
        transform: rotate(360deg);
      }
    }

    @keyframes sparkleFade {
      from {
        opacity: 1;
      }
      to {
        opacity: 0;
      }
    }

    /* „ÉÜ„Çπ„Éà„Éú„Çø„É≥ÔºàÈñãÁô∫Áî®Ôºâ */
    .test-controls {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(0, 0, 0, 0.8);
      padding: 1rem;
      border-radius: 0.5rem;
      color: white;
      z-index: 1000;
    }

    .test-btn {
      display: block;
      width: 100%;
      padding: 0.5rem 1rem;
      margin-bottom: 0.5rem;
      background: #d946a6;
      color: white;
      border: none;
      border-radius: 0.25rem;
      cursor: pointer;
      font-weight: 600;
    }

    .test-btn:hover {
      background: #b8358a;
    }
  </style>
</head>
<body>
  <!-- „Ç®„Éï„Çß„ÇØ„Éà„Ç≥„É≥„ÉÜ„Éä -->
  <div id="effectContainer"></div>

  <!-- „ÉÜ„Çπ„Éà„Ç≥„É≥„Éà„É≠„Éº„É´ÔºàÈñãÁô∫Áî®Ôºâ -->
  <div class="test-controls">
    <div style="margin-bottom: 1rem; font-weight: 700;">„ÉÜ„Çπ„ÉàÁî®„Ç≥„É≥„Éà„É≠„Éº„É´</div>
    <button class="test-btn" onclick="testCard('action', 'N')">„Ç¢„ÇØ„Ç∑„Éß„É≥ (N)</button>
    <button class="test-btn" onclick="testCard('visual', 'SR')">„Éì„Ç∏„É•„Ç¢„É´ (SR)</button>
    <button class="test-btn" onclick="testCard('message', 'UR')">„É°„ÉÉ„Çª„Éº„Ç∏ (UR)</button>
  </div>

  <script>
    // „Ç´„Éº„Éâ„Ç®„Éï„Çß„ÇØ„Éà„ÇíË°®Á§∫
    function displayCardEffect(cardData) {
      const container = document.getElementById('effectContainer');

      // „Ç´„Éº„Éâ„Ç®„Éï„Çß„ÇØ„ÉàË¶ÅÁ¥†„Çí‰ΩúÊàê
      const cardEffect = document.createElement('div');
      cardEffect.className = 'card-effect';

      // „Ç´„Éº„Éâ„Ç¢„Ç§„Ç≥„É≥
      const icons = {
        'action': '‚ö°',
        'visual': '‚ú®',
        'message': 'üí¨'
      };

      cardEffect.innerHTML = `
        <div class="card-icon">${icons[cardData.type] || 'üé¥'}</div>
        <div class="card-name">${cardData.name}</div>
        <div class="card-rarity ${cardData.rarity.toLowerCase()}">${cardData.rarity}</div>
        ${cardData.viewerMessage ? `
          <div class="viewer-message">
            ${cardData.viewerMessage}
          </div>
          <div class="viewer-name">- ${cardData.viewerName || 'Ë¶ñËÅ¥ËÄÖ'} -</div>
        ` : ''}
      `;

      container.appendChild(cardEffect);

      // „Éë„Éº„ÉÜ„Ç£„ÇØ„É´„Ç®„Éï„Çß„ÇØ„Éà„ÇíÁîüÊàê
      if (cardData.rarity === 'UR' || cardData.rarity === 'SR') {
        createParticles(50);
      } else {
        createParticles(20);
      }

      // „Åç„Çâ„Åç„Çâ„Ç®„Éï„Çß„ÇØ„Éà
      if (cardData.type === 'visual' || cardData.rarity === 'UR') {
        createSparkles(30);
      }

      // ÂäπÊûúÈü≥Ôºà„É¢„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„Å™„ÅÆ„ÅßÂÆüÈöõ„Å´„ÅØÂÜçÁîü„Åó„Å™„ÅÑÔºâ
      console.log('Playing sound effect for card:', cardData);

      // 5ÁßíÂæå„Å´„Éï„Çß„Éº„Éâ„Ç¢„Ç¶„Éà
      setTimeout(() => {
        cardEffect.classList.add('fadeOut');
        setTimeout(() => {
          container.removeChild(cardEffect);
        }, 500);
      }, 5000);
    }

    // „Éë„Éº„ÉÜ„Ç£„ÇØ„É´„ÇíÁîüÊàê
    function createParticles(count) {
      const container = document.getElementById('effectContainer');

      for (let i = 0; i < count; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';

        // „É©„É≥„ÉÄ„É†„Å™‰ΩçÁΩÆ
        const x = Math.random() * window.innerWidth;
        const y = Math.random() * window.innerHeight;

        particle.style.left = x + 'px';
        particle.style.top = y + 'px';

        // „É©„É≥„ÉÄ„É†„Å™Ëâ≤
        const colors = ['#d946a6', '#818cf8', '#fbbf24', '#10b981'];
        particle.style.background = colors[Math.floor(Math.random() * colors.length)];

        // „É©„É≥„ÉÄ„É†„Å™ÈÅÖÂª∂
        particle.style.animationDelay = Math.random() * 0.5 + 's';

        container.appendChild(particle);

        // 3ÁßíÂæå„Å´ÂâäÈô§
        setTimeout(() => {
          if (particle.parentNode) {
            container.removeChild(particle);
          }
        }, 3000);
      }
    }

    // „Åç„Çâ„Åç„Çâ„Ç®„Éï„Çß„ÇØ„Éà„ÇíÁîüÊàê
    function createSparkles(count) {
      const container = document.getElementById('effectContainer');

      for (let i = 0; i < count; i++) {
        const sparkle = document.createElement('div');
        sparkle.className = 'sparkle';

        // „É©„É≥„ÉÄ„É†„Å™‰ΩçÁΩÆ
        const x = Math.random() * window.innerWidth;
        const y = Math.random() * window.innerHeight;

        sparkle.style.left = x + 'px';
        sparkle.style.top = y + 'px';

        // „É©„É≥„ÉÄ„É†„Å™ÈÅÖÂª∂
        sparkle.style.animationDelay = Math.random() * 0.5 + 's';

        container.appendChild(sparkle);

        // 2ÁßíÂæå„Å´ÂâäÈô§
        setTimeout(() => {
          if (sparkle.parentNode) {
            container.removeChild(sparkle);
          }
        }, 2000);
      }
    }

    // „ÉÜ„Çπ„ÉàÁî®Èñ¢Êï∞
    function testCard(type, rarity) {
      const testData = {
        name: '„ÉÜ„Çπ„Éà„Ç´„Éº„Éâ',
        type: type,
        rarity: rarity,
        viewerName: '„ÉÜ„Çπ„ÉàË¶ñËÅ¥ËÄÖ',
        viewerMessage: type === 'message' ? '„Åì„Çå„ÅØ„ÉÜ„Çπ„Éà„É°„ÉÉ„Çª„Éº„Ç∏„Åß„ÅôÔºÅ' : null
      };

      displayCardEffect(testData);
    }

    // ÂÆüÈöõ„ÅÆ„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥„Åß„ÅØ„ÄÅ„Åì„Åì„ÅßSupabase Realtime„Å´Êé•Á∂ö„Åó„Å¶
    // ÊâøË™ç„Åï„Çå„Åü„Ç´„Éº„Éâ„ÅÆ„Ç§„Éô„É≥„Éà„Çí„É™„Çπ„Éã„É≥„Ç∞„Åó„Åæ„Åô
    console.log('OBS Overlay initialized');
    console.log('Waiting for card redemption events...');

    // „É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„Åã„ÇâÊâøË™ç„Ç§„Éô„É≥„Éà„ÇíÁõ£Ë¶ñÔºà„Éá„É¢Áî®Ôºâ
    window.addEventListener('storage', (e) => {
      if (e.key === 'overlayEvent' && e.newValue) {
        const event = JSON.parse(e.newValue);
        displayCardEffect(event.card);

        // „Ç§„Éô„É≥„Éà„Çí„ÇØ„É™„Ç¢
        localStorage.removeItem('overlayEvent');
      }
    });

    // ÂÆöÊúüÁöÑ„Å´„ÉÅ„Çß„ÉÉ„ÇØÔºà„Éá„É¢Áî®Ôºâ
    setInterval(() => {
      const event = localStorage.getItem('overlayEvent');
      if (event) {
        const data = JSON.parse(event);
        displayCardEffect(data.card);
        localStorage.removeItem('overlayEvent');
      }
    }, 1000);
  </script>
</body>
</html>
